<?php
// @codingStandardsIgnoreFile
/**
 * WordPress media types.
 *
 * @package WordPress
 * @subpackage Media
 * @since xxx
 */

/**
 * Return MIME aliases for a particular file extension.
 *
 * @since xxx
 *
 * @see {https://www.iana.org/assignments/media-types}
 * @see {https://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types}
 * @see {http://hg.nginx.org/nginx/raw-file/default/conf/mime.types}
 * @see {https://cgit.freedesktop.org/xdg/shared-mime-info/plain/freedesktop.org.xml.in}
 * @see {https://raw.githubusercontent.com/apache/tika/master/tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml}
 * @see {https://github.com/Blobfolio/blob-mimes}
 *
 * @param string $ext File extension.
 * @return array|bool MIME types. False on failure.
 */
function wp_get_mime_aliases( $ext = '' ) {
	$mimes = array(
%MIMES_BY_EXTENSION%
	);

	$ext = trim( strtolower( $ext ) );
	$ext = ltrim( $ext, '.' );
	if ( strlen( $ext ) && isset( $mimes[$ext] ) ) {
		return $mimes[$ext];
	}

	return false;
}

/**
 * Check extension and MIME pairing.
 *
 * @since xxx
 *
 * @param string $ext File extension.
 * @param string $mime MIME type.
 * @return bool True/false.
 */
function wp_check_mime_alias( $ext = '', $mime = '' ) {
	if ( false === ( $mimes = wp_get_mime_aliases( $ext ) ) ) {
		return false;
	}

	$mime = strtolower( sanitize_mime_type( $mime ) );
	$test = array( $mime );

	// We want to test for both x-subtype and subtype variants.
	$parts = explode( '/', $mime );
	$subtype = count( $parts ) - 1;
	if ( preg_match( '/^x\-/', $parts[$subtype] ) ) {
		$parts[$subtype] = preg_replace( '/^x\-/', '', $parts[$subtype] );
	}
	else {
		$parts[ $subtype ] = 'x-' . $parts[$subtype];
	}
	$test[] = implode( '/', $parts );

	// Overlap is success!
	$found = array_intersect( $test, $mimes );
	return count( $found ) > 0;
}

